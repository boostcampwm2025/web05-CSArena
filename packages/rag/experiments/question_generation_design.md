# Question Generation 설계 문서

## 개요

RAG 파이프라인에서 검색된 청크를 기반으로 면접 질문을 생성하는 모듈

---

## 문제 유형 (3가지)

### 1. 객관식 (Multiple Choice)
- 4지선다 형식
- 정답 1개 + 오답 3개
- 오답은 그럴듯하지만 명확히 틀린 선택지

### 2. 단답형 (Short Answer)
- 한 단어 또는 짧은 구문으로 답변
- 정확한 용어나 개념명을 묻는 질문
- 예: "TCP에서 연결 수립에 사용되는 3단계 과정의 이름은?"

### 3. 서술형 (Essay)
- 개념 설명, 비교, 원리 설명 요구
- 예: "TCP와 UDP의 차이점을 설명하시오"
- 모범 답안 제공

---

## 난이도 레벨 (1~3)

| 레벨 | 설명 | 질문 특성 |
|------|------|----------|
| 1 | 기초 | 단순 개념 정의, 용어 암기 |
| 2 | 중급 | 개념 비교, 동작 원리 설명 |
| 3 | 심화 | 상황 적용, 장단점 분석, 설계 고려사항 |

---

## 출력 스키마

```python
@dataclass
class GeneratedQuestion:
    # 기본 정보
    question_type: str  # "multiple_choice" | "short_answer" | "essay"
    difficulty: int     # 1, 2, 3

    # 문제 내용
    question: str       # 질문 텍스트

    # 정답 정보 (유형별 다름)
    answer: str         # 정답 (단답형, 서술형)
    options: list[str]  # 선택지 (객관식만, 4개)
    correct_index: int  # 정답 인덱스 (객관식만, 0-3)

    # 메타데이터
    explanation: str    # 해설
    category_id: int    # 카테고리 ID
    chunk_ids: list[int]  # 참조 청크 ID 목록
```

---

## 프롬프트 설계

### 시스템 프롬프트 (공통)

```
당신은 IT 기술 면접 문제 출제 전문가입니다.
주어진 컨텍스트를 바탕으로 취준생/주니어 개발자 대상 면접 문제를 생성합니다.

**규칙:**
1. 반드시 제공된 컨텍스트 내용만을 기반으로 문제를 생성합니다.
2. 한국어로 작성합니다. (영어 기술 용어는 그대로 사용 가능)
3. 명확하고 모호하지 않은 문제를 작성합니다.
4. 실제 면접에서 나올 법한 실용적인 문제를 작성합니다.
```

### 객관식 프롬프트

```
다음 컨텍스트를 바탕으로 4지선다 객관식 문제를 생성하세요.

**컨텍스트:**
{context}

**카테고리:** {category_name}
**난이도:** {difficulty_level} (1=기초, 2=중급, 3=심화)

**출력 형식 (JSON):**
{
  "question": "질문 텍스트",
  "options": ["선택지1", "선택지2", "선택지3", "선택지4"],
  "correct_index": 0,
  "explanation": "정답 해설"
}

**주의사항:**
- 오답 선택지는 그럴듯하지만 명확히 틀려야 합니다
- 정답은 컨텍스트에서 직접 확인 가능해야 합니다
- "모두 맞다", "없다" 같은 선택지는 피하세요
```

### 단답형 프롬프트

```
다음 컨텍스트를 바탕으로 단답형 문제를 생성하세요.

**컨텍스트:**
{context}

**카테고리:** {category_name}
**난이도:** {difficulty_level} (1=기초, 2=중급, 3=심화)

**출력 형식 (JSON):**
{
  "question": "질문 텍스트 (빈칸 또는 질문 형태)",
  "answer": "정답 (한 단어 또는 짧은 구문)",
  "explanation": "정답 해설"
}

**주의사항:**
- 정답은 정확한 기술 용어여야 합니다
- 여러 정답이 가능한 모호한 질문은 피하세요
- 예: "___은/는 TCP에서 연결 수립에 사용되는 3단계 과정이다."
```

### 서술형 프롬프트

```
다음 컨텍스트를 바탕으로 서술형 문제를 생성하세요.

**컨텍스트:**
{context}

**카테고리:** {category_name}
**난이도:** {difficulty_level} (1=기초, 2=중급, 3=심화)

**출력 형식 (JSON):**
{
  "question": "질문 텍스트",
  "answer": "모범 답안 (2-4문장)",
  "explanation": "채점 포인트 및 추가 설명"
}

**난이도별 질문 유형:**
- 레벨 1: "~이란 무엇인가?", "~의 정의를 설명하시오"
- 레벨 2: "~와 ~의 차이점을 설명하시오", "~의 동작 원리를 설명하시오"
- 레벨 3: "~의 장단점을 비교하시오", "~를 사용하는 이유를 설명하시오"
```

---

## 구현 흐름

```
1. 입력: CategoryInfo + RetrievedChunks
2. 컨텍스트 조합 (청크 내용 합치기)
3. 문제 유형 선택 (랜덤 또는 지정)
4. 난이도 선택 (랜덤 또는 지정)
5. 해당 프롬프트로 LLM 호출
6. JSON 파싱 및 검증
7. GeneratedQuestion 객체 반환
```

---

## 파일 구조

```
packages/rag/
├── question_generator.py   # 메인 생성 로직
├── prompts/
│   ├── __init__.py
│   ├── multiple_choice.py  # 객관식 프롬프트
│   ├── short_answer.py     # 단답형 프롬프트
│   └── essay.py            # 서술형 프롬프트
└── schemas.py              # 데이터 스키마 정의
```

---

## 검증 항목

1. **JSON 파싱**: LLM 출력이 올바른 JSON인지
2. **필수 필드**: 모든 필수 필드가 존재하는지
3. **객관식 검증**:
   - options 개수 = 4
   - correct_index가 0-3 범위인지
4. **빈 값 검증**: question, answer가 비어있지 않은지

---

## 다음 단계

1. schemas.py 작성
2. prompts/ 디렉토리 및 프롬프트 파일 작성
3. question_generator.py 구현
4. 테스트 실행 및 검증
